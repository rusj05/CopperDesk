<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Currency Arbitrage Tool</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background: linear-gradient(to right, #1e3c72, #2a5298);
            color: #ffffff;
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 2rem;
        }
        .container {
            background: #111;
            padding: 2rem;
            border-radius: 12px;
            max-width: 400px;
            margin: auto;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }
        select, input {
            width: 100%;
            padding: 0.6rem;
            margin: 0.5rem 0;
            border-radius: 6px;
            border: none;
            font-size: 1rem;
        }
        button {
            width: 100%;
            padding: 0.75rem;
            background-color: #1abc9c;
            border: none;
            border-radius: 6px;
            color: white;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 0.75rem;
        }
        .result {
            margin-top: 1rem;
            font-size: 1rem;
        }
        canvas {
            margin-top: 2rem;
            max-width: 300px;
            height: auto;
        }
        label {
            display: block;
            text-align: left;
            margin-top: 1rem;
            font-size: 0.95rem;
            color: #ddd;
        }
    </style>
</head>
<body>
    <h1>Currency Arbitrage Tool</h1>
    <div class="container">
        <label for="from">From currency:</label>
        <select id="from"></select>

        <label for="via">Via currency (optional):</label>
        <select id="via">
            <option value="">--None--</option>
        </select>

        <label for="to">To currency:</label>
        <select id="to"></select>

        <label for="amount">Amount:</label>
        <input type="number" id="amount" value="1000" />

        <label for="fee">Conversion Fee % (per step):</label>
        <input type="number" id="fee" value="0" />

        <button onclick="convert()">Convert</button>

        <div class="result" id="result"></div>
    </div>

    <div class="container">
        <canvas id="chart"></canvas>
    </div>

    <script>
        const currencies = ["USD", "EUR", "DKK", "CAD", "GBP", "JPY", "NOK"];

        currencies.forEach((cur) => {
            ["from", "via", "to"].forEach((id) => {
                const opt = document.createElement("option");
                opt.value = cur;
                opt.textContent = cur;
                document.getElementById(id).appendChild(opt.cloneNode(true));
            });
        });

        async function getRate(base, target) {
            if (!base || !target || base === target) return 1;
            const res = await fetch(`https://api.exchangerate.host/latest?base=${base}&symbols=${target}`);
            const data = await res.json();
            return data.rates[target];
        }

        async function convert() {
            const from = document.getElementById("from").value;
            const to = document.getElementById("to").value;
            const via = document.getElementById("via").value;
            const amount = parseFloat(document.getElementById("amount").value);
            const fee = parseFloat(document.getElementById("fee").value) / 100;
            let finalAmount = amount;
            let steps = [amount];

            if (via) {
                const rate1 = await getRate(from, via);
                const afterFee1 = (finalAmount * rate1) * (1 - fee);
                steps.push(afterFee1);

                const rate2 = await getRate(via, to);
                finalAmount = (afterFee1 * rate2) * (1 - fee);
                steps.push(finalAmount);
            } else {
                const rate = await getRate(from, to);
                finalAmount = (finalAmount * rate) * (1 - fee);
                steps.push(finalAmount);
            }

            const dkkRate = await getRate(from, "DKK");
            const initialInDKK = amount * dkkRate;
            const profit = finalAmount - initialInDKK;
            const profitPct = ((profit / initialInDKK) * 100).toFixed(2);

            document.getElementById("result").innerHTML = 
                `${amount} ${from} â†’ ${to} = ${finalAmount.toFixed(2)} ${to}<br>Profit: ${profit.toFixed(2)} DKK (${profitPct}%) after fees`;

            drawChart([from, via || to, to], steps);
        }

        function drawChart(labels, values) {
            const ctx = document.getElementById("chart").getContext("2d");
            if (window.myChart) window.myChart.destroy();
            window.myChart = new Chart(ctx, {
                type: "line",
                data: {
                    labels: labels,
                    datasets: [{
                        label: "Conversion Progress",
                        data: values,
                        borderColor: "#1abc9c",
                        backgroundColor: "transparent",
                        pointBackgroundColor: "#1abc9c",
                        tension: 0.4,
                    }]
                },
                options: {
                    plugins: {
                        legend: {
                            labels: { color: "#fff" }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: "#fff" }
                        },
                        y: {
                            ticks: { color: "#fff" }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
