<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Currency Arbitrage Tool</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to right, #2c3e50, #3498db);
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px 20px;
    }
    h1 {
      margin-bottom: 20px;
    }
    .box {
      background: #1c2331;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
      margin: 20px;
      width: 100%;
      max-width: 400px;
    }
    label, select, input {
      display: block;
      width: 100%;
      margin-bottom: 10px;
    }
    select, input {
      padding: 10px;
      border-radius: 5px;
      border: none;
    }
    button {
      padding: 12px;
      width: 100%;
      border: none;
      background-color: #1abc9c;
      color: white;
      font-weight: bold;
      cursor: pointer;
      border-radius: 5px;
      transition: background 0.3s ease;
    }
    button:hover {
      background-color: #16a085;
    }
    .result {
      text-align: center;
      margin-top: 10px;
      font-weight: bold;
    }
    .opportunity, .top-opportunity {
      margin: 5px 0;
      text-align: center;
    }
    .top-opportunity {
      font-weight: bold;
      color: #1abc9c;
    }
    hr { border: 0.5px solid #1abc9c; margin: 20px 0; }
  </style>
</head>
<body>

  <h1>Currency Arbitrage Tool</h1>

  <div class="box">
    <label>From currency:</label>
    <select id="from"></select>

    <label>To currency:</label>
    <select id="to"></select>

    <label>Amount:</label>
    <input type="number" id="amount" value="1000"/>

    <button onclick="calculate()">Convert</button>
    <div class="result" id="conversionResult"></div>
  </div>

  <div class="box">
    <h3>Top Arbitrage Opportunity</h3>
    <div id="topArb">Loading...</div>
  </div>

  <div class="box">
    <h3>Best 3-Currency Route for Conversion</h3>
    <label>Buy in:</label>
    <select id="filterFrom"></select>
    <label>Sell in:</label>
    <select id="filterTo"></select>
    <button onclick="suggestMiddle()">Find Best Middle Currency</button>
    <div class="result" id="filterResult"></div>
  </div>

  <script>
    const currencies = ["CAD", "DKK", "USD", "NOK", "EUR", "GBP", "JPY", "CHF", "SEK", "AUD"];

    const populate = (id) => {
      const el = document.getElementById(id);
      currencies.forEach(curr => {
        el.innerHTML += `<option value="${curr}">${curr}</option>`;
      });
    };

    ["from", "to", "filterFrom", "filterTo"].forEach(populate);

    async function fetchRate(base, target) {
      if (base === target) return 1;
      const res = await fetch(`https://api.frankfurter.app/latest?amount=1&from=${base}&to=${target}`);
      const data = await res.json();
      return data.rates[target];
    }

    async function calculate() {
      const from = document.getElementById("from").value;
      const to = document.getElementById("to").value;
      const amount = parseFloat(document.getElementById("amount").value);
      const rate = await fetchRate(from, to);
      const result = amount * rate;
      document.getElementById("conversionResult").innerText = `${amount} ${from} = ${result.toFixed(2)} ${to}`;
    }

    async function findTopArbitrage() {
      let top = "";
      let topProfit = 0;
      const base = 1000;

      for (let a of currencies) {
        for (let b of currencies) {
          if (b === a) continue;
          for (let c of currencies) {
            if (c === a || c === b) continue;

            try {
              const r1 = await fetchRate(a, b);
              const r2 = await fetchRate(b, c);
              const r3 = await fetchRate(c, a);
              const final = base * r1 * r2 * r3;
              const profit = final - base;

              if (profit > topProfit) {
                topProfit = profit;
                top = `${a} → ${b} → ${c} → ${a} = ${final.toFixed(2)} (${profit.toFixed(2)} profit)`;
              }
            } catch {}
          }
        }
      }

      document.getElementById("topArb").innerText = top || "No profitable arbitrage found.";
    }

    async function suggestMiddle() {
      const from = document.getElementById("filterFrom").value;
      const to = document.getElementById("filterTo").value;
      let best = "";
      let bestGain = 0;
      const base = 1000;

      for (let mid of currencies) {
        if (mid === from || mid === to) continue;

        try {
          const r1 = await fetchRate(from, mid);
          const r2 = await fetchRate(mid, to);
          const result = base * r1 * r2;
          const gain = result - (await fetchRate(from, to)) * base;

          if (gain > bestGain) {
            bestGain = gain;
            best = `${from} → ${mid} → ${to} = ${result.toFixed(2)} (Gain: ${gain.toFixed(2)})`;
          }
        } catch {}
      }

      document.getElementById("filterResult").innerText = best || "No profitable middle currency found.";
    }

    findTopArbitrage();
  </script>
</body>
</html>
