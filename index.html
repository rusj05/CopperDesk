<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Currency Arbitrage Tool</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #1a2a6c, #1a3c78);
      color: #fff;
      text-align: center;
      margin: 0;
      padding: 2rem;
    }
    .container {
      background-color: #111;
      padding: 2rem;
      border-radius: 10px;
      max-width: 400px;
      margin: 0 auto;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 5px;
      border: none;
    }
    button {
      background-color: #0f0;
      color: #000;
      font-weight: bold;
      cursor: pointer;
    }
    .result, .chart-container {
      margin-top: 1rem;
    }
    canvas {
      background-color: #222;
      border-radius: 8px;
      padding: 1rem;
    }
  </style>
</head>
<body>
  <h1>Currency Arbitrage Tool</h1>
  <div class="container">
    <select id="fromCurrency"></select>
    <select id="viaCurrency"></select>
    <select id="toCurrency"></select>
    <input type="number" id="amount" placeholder="Amount" value="1000" />
    <input type="number" id="fee" placeholder="Conversion Fee % (per step)" value="1" step="0.01" />
    <button onclick="calculateArbitrage()">Convert</button>
    <div class="result" id="result"></div>
  </div>

  <div class="chart-container">
    <canvas id="conversionChart" width="400" height="200"></canvas>
  </div>

  <script>
    const fromSelect = document.getElementById("fromCurrency");
    const viaSelect = document.getElementById("viaCurrency");
    const toSelect = document.getElementById("toCurrency");
    const resultDiv = document.getElementById("result");
    const currencies = ["USD", "CAD", "DKK", "EUR", "JPY", "AUD", "NOK"];

    currencies.forEach(cur => {
      [fromSelect, viaSelect, toSelect].forEach(sel => {
        const opt = document.createElement("option");
        opt.value = cur;
        opt.textContent = cur;
        sel.appendChild(opt.cloneNode(true));
      });
    });

    const ctx = document.getElementById("conversionChart").getContext("2d");
    let chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Conversion Progress',
          data: [],
          borderColor: '#0f0',
          backgroundColor: 'rgba(0,255,0,0.1)',
          fill: true
        }]
      },
      options: {
        scales: {
          x: { title: { display: true, text: 'Currency' } },
          y: { title: { display: true, text: 'Amount' } }
        }
      }
    });

    async function getRate(from, to) {
      const res = await fetch(`https://api.exchangerate.host/convert?from=${from}&to=${to}`);
      const data = await res.json();
      return data.result;
    }

    async function calculateArbitrage() {
      const from = fromSelect.value;
      const via = viaSelect.value;
      const to = toSelect.value;
      const amount = parseFloat(document.getElementById("amount").value);
      const fee = parseFloat(document.getElementById("fee").value) / 100;

      let steps = [from];
      let amounts = [amount];
      let finalAmount = amount;

      if (via && via !== from && via !== to) {
        const r1 = await getRate(from, via);
        finalAmount *= r1 * (1 - fee);
        steps.push(via);
        amounts.push(finalAmount);

        const r2 = await getRate(via, to);
        finalAmount *= r2 * (1 - fee);
        steps.push(to);
        amounts.push(finalAmount);
      } else {
        const r = await getRate(from, to);
        finalAmount *= r * (1 - fee);
        steps.push(to);
        amounts.push(finalAmount);
      }

      const baseRate = await getRate(from, to);
      const directAmount = amount * baseRate;
      const profit = finalAmount - directAmount;
      const profitPercent = ((profit / directAmount) * 100).toFixed(2);

      resultDiv.innerHTML = `
        ${amount} ${from} â†’ ${to} = ${finalAmount.toFixed(2)} ${to}<br>
        Direct conversion: ${directAmount.toFixed(2)} ${to}<br>
        Profit: ${profit.toFixed(2)} ${to} (${profitPercent}%) after fees
      `;

      chart.data.labels = steps;
      chart.data.datasets[0].data = amounts;
      chart.update();
    }

    viaSelect.innerHTML = '<option value="">-- None --</option>' + viaSelect.innerHTML;
    fromSelect.value = 'USD';
    toSelect.value = 'DKK';
  </script>
</body>
</html>
