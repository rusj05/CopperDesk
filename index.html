<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Currency Arbitrage Tool</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f4f7fa;
      color: #333;
      padding: 40px 20px;
    }
    h1, h3 {
      text-align: center;
      color: #2c3e50;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
    }
    .box {
      background: #ffffff;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    label, select, input, button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      margin-bottom: 20px;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    button {
      background-color: #3498db;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #2980b9;
    }
    .result {
      text-align: center;
      font-weight: bold;
      font-size: 18px;
    }
    canvas {
      max-width: 100%;
      height: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Currency Arbitrage Tool</h1>

    <div class="box">
      <label>From currency:</label>
      <select id="from"></select>

      <label>To currency:</label>
      <select id="to"></select>

      <label>Amount:</label>
      <input type="number" id="amount" value="1000"/>

      <button onclick="calculate()">Convert</button>
      <div class="result" id="conversionResult"></div>
    </div>

    <div class="box">
      <h3>Top Arbitrage Opportunity</h3>
      <div class="result" id="topArb">Loading...</div>
    </div>

    <div class="box">
      <h3>Best 3-Currency Route</h3>
      <label>Buy in:</label>
      <select id="filterFrom"></select>
      <label>Sell in:</label>
      <select id="filterTo"></select>
      <button onclick="suggestMiddle()">Find Best Middle Currency</button>
      <div class="result" id="filterResult"></div>
    </div>

    <div class="box">
      <h3>Arbitrage Visual</h3>
      <canvas id="arbChart"></canvas>
    </div>
  </div>

  <script>
    const currencies = ["CAD", "DKK", "USD", "NOK", "EUR", "GBP", "JPY", "CHF", "SEK", "AUD"];

    const populate = (id) => {
      const el = document.getElementById(id);
      currencies.forEach(curr => {
        el.innerHTML += `<option value="${curr}">${curr}</option>`;
      });
    };

    ["from", "to", "filterFrom", "filterTo"].forEach(populate);

    async function fetchRate(base, target) {
      if (base === target) return 1;
      const res = await fetch(`https://api.frankfurter.app/latest?amount=1&from=${base}&to=${target}`);
      const data = await res.json();
      return data.rates[target];
    }

    async function calculate() {
      const from = document.getElementById("from").value;
      const to = document.getElementById("to").value;
      const amount = parseFloat(document.getElementById("amount").value);
      const rate = await fetchRate(from, to);
      const result = amount * rate;
      document.getElementById("conversionResult").innerText = `${amount} ${from} = ${result.toFixed(2)} ${to}`;
    }

    async function findTopArbitrage() {
      let top = "";
      let topProfit = 0;
      const base = 1000;
      let bestRoute = [];

      for (let a of currencies) {
        for (let b of currencies) {
          if (b === a) continue;
          for (let c of currencies) {
            if (c === a || c === b) continue;

            try {
              const r1 = await fetchRate(a, b);
              const r2 = await fetchRate(b, c);
              const r3 = await fetchRate(c, a);
              const final = base * r1 * r2 * r3;
              const profit = final - base;
              const profitPct = (profit / base) * 100;

              if (profit > topProfit) {
                topProfit = profit;
                bestRoute = [a, b, c, a];
                top = `${a} → ${b} → ${c} → ${a} = ${final.toFixed(2)} (Profit: ${profit.toFixed(2)} | ${profitPct.toFixed(2)}%)`;
              }
            } catch {}
          }
        }
      }

      document.getElementById("topArb").innerText = top || "No profitable arbitrage found.";
      drawChart(bestRoute);
    }

    async function suggestMiddle() {
      const from = document.getElementById("filterFrom").value;
      const to = document.getElementById("filterTo").value;
      let best = "";
      let bestGain = 0;
      const base = 1000;

      for (let mid of currencies) {
        if (mid === from || mid === to) continue;

        try {
          const r1 = await fetchRate(from, mid);
          const r2 = await fetchRate(mid, to);
          const result = base * r1 * r2;
          const direct = await fetchRate(from, to) * base;
          const gain = result - direct;
          const gainPct = (gain / base) * 100;

          if (gain > bestGain) {
            bestGain = gain;
            best = `${from} → ${mid} → ${to} = ${result.toFixed(2)} (Gain: ${gain.toFixed(2)} | ${gainPct.toFixed(2)}%)`;
          }
        } catch {}
      }

      document.getElementById("filterResult").innerText = best || "No profitable middle currency found.";
    }

    function drawChart(route) {
      if (window.arbChart) window.arbChart.destroy();

      const ctx = document.getElementById("arbChart").getContext("2d");
      window.arbChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: route,
          datasets: [{
            label: 'Arbitrage Route',
            data: Array(route.length).fill().map((_, i) => i),
            backgroundColor: 'rgba(52,152,219,0.2)',
            borderColor: '#3498db',
            borderWidth: 2,
            fill: false,
            tension: 0.3,
            pointRadius: 5,
            pointBackgroundColor: '#1abc9c'
          }]
        },
        options: {
          scales: {
            y: {
              display: false
            }
          }
        }
      });
    }

    findTopArbitrage();
  </script>
</body>
</html>
